const fs = require('fs');
const sharp = require('sharp');
const { globSync } = require('glob');
const { execSync } = require('child_process');

const sizes = [
  { width: 160, height: 160 },
  { width: 320, height: 320 },
];

function deletePNGFiles() {
  const files = globSync("**/*_*x*.png"); // This pattern matches PNGs that were likely generated by the conversion function
  files.forEach(file => {
    fs.unlinkSync(file);
    console.log('Deleted:', file);
  });
}

function convertSVGToPNG() {
  const files = globSync("**/*.svg");
  files.forEach(file => {
    sizes.forEach(size => {
      const outputPath = file.replace('.svg', `_${size.width}x${size.height}.png`);
      if (!fs.existsSync(outputPath)) {
        sharp(file)
          .resize(size.width, size.height)
          .toFile(outputPath, (err) => {
            if (err) {
              console.error('Error converting:', file, err);
            } else {
              console.log('Converted:', file, 'to', outputPath);
              // Add the newly generated file to git
              execSync(`git add ${outputPath}`);
            }
          });
      } else {
        console.log('Skipped conversion for existing file:', outputPath);
      }
    });
  });
}

if (process.argv[2] === "delete") {
  deletePNGFiles();
} else if (process.argv[2] === "convert") {
  convertSVGToPNG();
} else {
  console.log("Please provide a valid command: delete or convert");
}
